<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Basic CRUD Apps</title>
  </head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" />

  <style>
    body{
        padding: 8px;
    }
    .single-product{
        border: 1px solid #000000;
        padding: 8px;
        margin: 4px;
    }
  </style>
  <body>

    <div class="row">
        <div class="col-md-12">
            <form id="form-insert" action="http://localhost:3000/insert-product-histories" method="post">
                <div class="row">
                    <div class="col-6">
                        <label for="">Product Name</label>
                        <input type="text" name="nama" class="form-control">
                    </div>
                    <div class="col-6">
                        <label for="">Price</label>
                        <input type="number" name="harga" class="form-control">
                    </div>
                </div>
                
                <button type="button" class="btn btn-danger my-3" onclick="submitProduct()">Submit</button>
            </form>
        </div>
        <div class="col-md-12">
            <div id="product-section"></div>
        </div>
    </div>
    
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script>
        $(document).ready(()=>{
            list()
        });

        function list() 
        {
            $.get("http://localhost:3000/product-histories", (response) => {
                var mHtml = "<div class='row'>"
                $.each(response.datas, (key, product) => {
                    mHtml += "<div class='col-4'>"
                    mHtml += "<div class='single-product'>"
                    mHtml += "<h5>"+product.kode+"</h5>"
                    mHtml += "<p>"+product.nama+"</p>"
                    mHtml += "<p>Rp"+product.harga+"</p>"
                    mHtml += "</div>"
                    mHtml += "</div>"
                })
                mHtml += "</div>"

                $("#product-section").html(mHtml)
            })
        }

        function submitProduct()
        {
            const formId = "#form-insert"
            const postDatas = $(formId).serialize()
            const dataUrl = $(formId).attr("action")


            $.post(dataUrl, postDatas)
            .done((response) => {
                if(response.status){
                    list()
                }
            })
            .fail(()=>{
                alert("error")
            })
        }

    </script>
  </body>
</html>